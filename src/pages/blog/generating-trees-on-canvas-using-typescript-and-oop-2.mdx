---
title: –†–∏—Å—É–µ–º –¥–µ—Ä–µ–≤—å—è, —á–∞—Å—Ç—å 2. –ì–µ–æ–º–µ—Ç—Ä–∏—è, –≥—Ä–∞—Ñ–∏–∫–∞ –∏ —Ä–∞–±–æ—Ç–∞ —Å DOM
description: –ü–∏—à–µ–º —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–µ—Ä–µ–≤—å–µ–≤ —Å –ø–æ–º–æ—â—å—é TypeScript –ø–æ –≤—Å–µ–º –ø—Ä–∞–≤–∏–ª–∞–º –û–û–ü –∏ –∑–∞–≤–µ—Ç–∞–º ¬´–ß–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã¬ª –ú–∞—Ä—Ç–∏–Ω–∞
datetime: 2021-04-10T12:05
slug: /blog/generating-trees-on-canvas-using-typescript-and-oop-2
tags:
  - dev
  - oop
  - solid
  - ts
---

# –†–∏—Å—É–µ–º –¥–µ—Ä–µ–≤—å—è, —á–∞—Å—Ç—å 2. –ì–µ–æ–º–µ—Ç—Ä–∏—è, –≥—Ä–∞—Ñ–∏–∫–∞ –∏ —Ä–∞–±–æ—Ç–∞ —Å DOM

–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø–∏—Å–∞—Ç—å —Ä–∏—Å–æ–≤–∞–ª–∫—É –¥–µ—Ä–µ–≤—å–µ–≤ –ø–æ –∫–∞–Ω–æ–Ω–∞–º –û–û–ü.

–í [–ø—Ä–µ–¥—ã–¥—É—â–µ–π —á–∞—Å—Ç–∏](/blog/generating-trees-on-canvas-using-typescript-and-oop) –º—ã —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–ª–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π. –í –∫–æ–Ω—Ü–µ –Ω–∞–ø–∏—Å–∞–ª–∏ –∫–æ–¥ –º–æ–¥—É–ª—è L-—Å–∏—Å—Ç–µ–º, –∫–æ—Ç–æ—Ä—ã–π –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º.

–í —ç—Ç–æ–º –ø–æ—Å—Ç–µ –º—ã —Å–æ–∑–¥–∞–¥–∏–º –º–æ–¥—É–ª—å –≥–µ–æ–º–µ—Ç—Ä–∏–∏ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –ø–æ–ª–æ–∂–µ–Ω–∏—è —Ç–æ—á–µ–∫ –Ω–∞ –ø–ª–æ—Å–∫–æ—Å—Ç–∏. –ü–æ—Å–ª–µ –Ω–µ–≥–æ —Å–æ–∑–¥–∞–¥–∏–º –º–æ–¥—É–ª–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å DOM –∏ `canvas`. –ê –≤ –∫–æ–Ω—Ü–µ –≤—ã–≤–µ–¥–µ–º –Ω–∞ —ç–∫—Ä–∞–Ω –ø–µ—Ä–≤—ã–π –ø—Ä–æ—Å—Ç–µ–Ω—å–∫–∏–π —Ä–∏—Å—É–Ω–æ–∫.

## –ü–∏—à–µ–º –º–æ–¥—É–ª—å –≥–µ–æ–º–µ—Ç—Ä–∏–∏

–í—Ç–æ—Ä–æ–π –º–æ–¥—É–ª—å –≤ –¥–æ–º–µ–Ω–Ω–æ–º —Å–ª–æ–µ ‚Äî –º–æ–¥—É–ª—å –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö —Ä–∞—Å—á—ë—Ç–æ–≤. [–°–æ–≥–ª–∞—Å–Ω–æ ISP –º—ã —Ä–∞–∑–¥–µ–ª–∏–º –µ–≥–æ](https://ota-solid.now.sh/isp) –Ω–∞ –¥–≤–µ —á–∞—Å—Ç–∏: –ø–µ—Ä–≤–∞—è –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Ñ–∏–≥—É—Ä—ã, –≤—Ç–æ—Ä–∞—è ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Å—Ç–∞—Ä—Ç–æ–≤—É—é —Ç–æ—á–∫—É –Ω–∞ –ø–ª–æ—Å–∫–æ—Å—Ç–∏, –æ—Ç–∫—É–¥–∞ –º—ã –±—É–¥–µ–º —Ñ–∏–≥—É—Ä—ã —Å—Ç—Ä–æ–∏—Ç—å.

–†–∞–∑–±–µ—Ä—ë–º—Å—è —Å –ø–µ—Ä–≤–æ–π —á–∞—Å—Ç—å—é. –û–±—ä—è–≤–∏–º –ø—É–±–ª–∏—á–Ω–æ–µ API:

```ts
// src/geometry/shape/types.ts

export interface ShapeBuilder {
  createLine(start: Point, length: Length, angle?: Angle): Line;
}
```

–î–æ–±–∞–≤–∏–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –¥–æ–º–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã:

```ts
// typings/geometry.d.ts

type PixelsAmount = number;
type DegreesAmount = number;
type Coordinate = number;

type Length = PixelsAmount;
type Angle = DegreesAmount;

type Point = {
  x: Coordinate;
  y: Coordinate;
};

type Size = {
  width: Length;
  height: Length;
};

type Line = {
  start: Point;
  end: Point;
};
```

–¢–µ–ø–µ—Ä—å –ø—Ä–∏—Å—Ç—É–ø–∏–º –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

```ts
// src/geometry/shape/implementation.ts

import { ShapeBuilder } from "./types";

export class CoreShapeBuilder implements ShapeBuilder {
  public createLine(start: Point, length: Length, angle: Angle = 0): Line {
    const radians = (angle * Math.PI) / 180;
    const end: Point = {
      x: start.x + length * Math.sin(radians),
      y: start.y - length * Math.cos(radians),
    };

    return { start, end };
  }
}
```

–î–µ—Ä–µ–≤–æ –±—É–¥–µ—Ç —Ä–∞—Å—Ç–∏ –≤–≤–µ—Ä—Ö, –ø–æ—ç—Ç–æ–º—É –º—ã —É–º–µ–Ω—å—à–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É Y –Ω–∞ –¥–ª–∏–Ω—É –æ—Ç—Ä–µ–∑–∫–∞. (–ù–∞—á–∞–ª–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —É `canvas` ‚Äî –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É.) –ï—Å–ª–∏ –∑–∞–¥–∞–Ω —É–≥–æ–ª –Ω–∞–∫–ª–æ–Ω–∞, –º–µ–Ω—è–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ç–æ—á–∫–∏ –ø–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–µ.

–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –º–æ–¥—É–ª—å:

```ts
// src/geometry/shape/composition.ts

import { container } from "../../composition";
import { CoreShapeBuilder } from "./implementation";
import { ShapeBuilder } from "./types";

container.registerSingleton<ShapeBuilder, CoreShapeBuilder>();

// –ò –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ–∞–π–ª `src/geometry/shape/composition.ts`
// –≤–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª–∞ `src/composition/index.ts`.
// –î–∞–ª–µ–µ —è –±—É–¥—É –æ–ø—É—Å–∫–∞—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ–± –∏–º–ø–æ—Ä—Ç–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏.
```

### –õ–∏—Ä–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å—Ç—É–ø–ª–µ–Ω–∏–µ –æ –Ω–µ–π–º–∏–Ω–≥–µ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ö

–í —Ü–µ–ª–æ–º, –∏–º—è –∫–ª–∞—Å—Å–∞ `CoreShapeBuilder` –º–Ω–µ –Ω–µ –æ—á–µ–Ω—å –Ω—Ä–∞–≤–∏—Ç—Å—è. –ó–¥–µ—Å—å –≤–ø–æ–ª–Ω–µ –±—ã –ø–æ–¥–æ—à–ª–æ –∏ –ø—Ä–æ—Å—Ç–æ `ShapeBuilder`, –Ω–æ —ç—Ç–æ –∏–º—è –∑–∞–Ω—è—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º.

–í —Å–ª—É—á–∞—è—Ö, –∫–æ–≥–¥–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è _—Ç–æ–ª—å–∫–æ 1 —Å–ø–æ—Å–æ–±–æ–º_, –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏—Å—å –∏ [–±–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞](https://thomaspoignant.medium.com/java-how-to-name-interface-and-implementor-94c0fa564b87). –ú—ã –±—ã –º–æ–≥–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞ –∫–∞–∫ API:

```ts
class ShapeBuilder {
  /* ... */
}

container.registerSingleton<ShapeBuilder>();
```

–ù–æ _–¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏_ –º—ã –±—É–¥–µ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é _–æ—Ç–¥–µ–ª—å–Ω–æ_ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞.

–ö—Å—Ç–∞—Ç–∏, –≤ C# –ø—Ä–æ–±–ª–µ–º–∞ —Å –Ω–µ–π–º–∏–Ω–≥–æ–º —Ä–µ—à–µ–Ω–∞ [–ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞](https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/names-of-classes-structs-and-interfaces), –Ω–æ –≤ TS –Ω–µ –ø—Ä–∏–Ω—è—Ç–æ –¥–æ–±–∞–≤–ª—è—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å—ã –≤ –Ω–∞–∑–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, —Ç–∞–∫ —á—Ç–æ –∏–º–µ–µ–º —á—Ç–æ –∏–º–µ–µ–º.

### –í—ã–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—É—é —Ç–æ—á–∫—É

–î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–æ—á–∫–∏, –æ—Ç–∫—É–¥–∞ –º—ã –±—É–¥–µ–º —Ä–∏—Å–æ–≤–∞—Ç—å —Ñ–∏–≥—É—Ä—ã, —Å–æ–∑–¥–∞–¥–∏–º –µ—â—ë –æ–¥–∏–Ω –º–æ–¥—É–ª—å. –û–±—ä—è–≤–∏–º –ø—É–±–ª–∏—á–Ω–æ–µ API:

```ts
// src/geometry/location/types.ts

export interface StartSelector {
  selectStart(): Point;
}
```

–ß—Ç–æ–±—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `selectStart`, –Ω–∞–º –Ω–∞–¥–æ –∑–Ω–∞—Ç—å —Ä–∞–∑–º–µ—Ä—ã ¬´–ø–æ–ª–æ—Ç–Ω–∞¬ª. –ú—ã –º–æ–∂–µ–º –ø–æ—Å—Ç—É–ø–∏—Ç—å –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:

- –ø–µ—Ä–µ–¥–∞—Ç—å —Ä–∞–∑–º–µ—Ä—ã –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç –º–µ—Ç–æ–¥–∞;
- —Å–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤–æ–æ–±—â–µ –≤—Å–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –≤–µ–ª–∏—á–∏–Ω—ã.

–Ø —Ä–µ—à–∏–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –º–æ–∂–Ω–æ –≤–Ω–µ–¥—Ä—è—Ç—å –æ–±—ã—á–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã. –ù–∞–ø–∏—à–µ–º –º–µ—Ç–æ–¥:

```ts
// src/geometry/location/implementation.ts

import { AppSettings } from "../../settings";
import { StartSelector } from "./types";

export class StartPointSelector implements StartSelector {
  public selectStart(): Point {
    const { width, height } = this.settings.canvasSize;

    return {
      x: Math.round(width / 2),
      y: height,
    };
  }
}
```

–í–Ω—É—Ç—Ä–∏ –º–µ—Ç–æ–¥–∞ –º—ã —Å—Å—ã–ª–∞–µ–º—Å—è –Ω–∞ `this.settings.canvasSize`. –°–µ–π—á–∞—Å –ø–æ–ª—è `this.settings` —É –Ω–∞—Å –Ω–µ—Ç, –µ–≥–æ –Ω–∞–¥–æ —Å–æ–∑–¥–∞—Ç—å. –ú—ã –º–æ–∂–µ–º —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é –∏–ª–∏ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ:

```
// 1. –ù–∞–ø—Ä—è–º—É—é:
export class StartPointSelector {
  settings = {/*‚Ä¶*/}
}

// 2. –ß–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä:
export class StartPointSelector {
  constructor(settings) {
    this.settings = settings;
  }
}
```

–ù–∞–º —É–¥–æ–±–Ω–µ–µ –≤—Å–µ–≥–æ –±—É–¥–µ—Ç —ç—Ç–æ –¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä ‚Äî —Ç–∞–∫ –º—ã —Å–º–æ–∂–µ–º —Å–ø–∏—Ö–Ω—É—Ç—å –≤—Å—é —Ä–∞–±–æ—Ç—É –ø–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–∞ DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä. –û–±–Ω–æ–≤–∏–º –∫–æ–¥:

```ts
// src/geometry/location/implementation.ts

export class StartPointSelector implements StartSelector {
  // –¢–∞–∫–∞—è –∑–∞–ø–∏—Å—å —Å—Ä–∞–∑—É –∂–µ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –ø–æ–ª—é,
  // –Ω–∞–º —É–∂–µ –Ω–µ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –µ–≥–æ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–ª–∞—Å—Å–µ —Ä—É–∫–∞–º–∏:
  constructor(private settings: AppSettings) {}

  // ‚Ä¶
}
```

–ü–æ—á–µ–º—É –º—ã –ø–æ–¥–º–µ—à–∏–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–º–µ–Ω–Ω–æ —Ç–∞–∫? –ú–æ–∂–Ω–æ –∂–µ –ø—Ä–æ—Å—Ç–æ —Å–æ—Å–ª–∞—Ç—å—Å—è –Ω–∞ –æ–±—ä–µ–∫—Ç. –î–∞, –Ω–æ —Ç–æ–≥–¥–∞ –Ω–∞–º –ø—Ä–∏–¥—ë—Ç—Å—è —Å–ª–µ–¥–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ. –ú—ã –∂–µ —Ö–æ—Ç–∏–º –æ—Ç–¥–∞—Ç—å –∑–∞–±–æ—Ç—É –æ –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω—É–∂–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É.

–í –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ –º—ã –≥–æ–≤–æ—Ä–∏–º –µ–º—É, ¬´–∫–æ–≥–¥–∞ –±—É–¥–µ—à—å —Å–æ–∑–¥–∞–≤–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ `StartPointSelector`, –ø–µ—Ä–µ–¥–∞–π –µ–º—É –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä _—á—Ç–æ-—Ç–æ, —á—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `AppSettings`_¬ª.

–°—Å—ã–ª–∞—è—Å—å –Ω–∞ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å) –º—ã [–ø–µ—Ä–µ—Å—Ç–∞—ë–º –∑–∞–≤–∏—Å–µ—Ç—å](https://ota-solid.now.sh/dip) –æ—Ç –ª—é–±—ã—Ö –¥–µ—Ç–∞–ª–µ–π –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –º–æ–¥—É–ª–µ–π. –ù–∞–º –Ω–µ –≤–∞–∂–Ω–æ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ, –∫–∞–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å. –ì–ª–∞–≤–Ω–æ–µ, —á—Ç–æ–±—ã —ç—Ç–æ _—á—Ç–æ-—Ç–æ_ —Å–æ–¥–µ—Ä–∂–∞–ª–æ –≤—Å–µ –º–µ—Ç–æ–¥—ã –∏ —Å–≤–æ–π—Å—Ç–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—ä—è–≤–ª–µ–Ω—ã –≤ `AppSettings`.

–í –¥–∞–ª—å–Ω–µ–π—à–µ–º –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º—ã –±—É–¥–µ–º –¥–æ–±–∞–≤–ª—è—Ç—å –∏–º–µ–Ω–Ω–æ —Ç–∞–∫.

### –°–æ–∑–¥–∞—ë–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–Ø –Ω–µ —É–≤–∏–¥–µ–ª —Å–º—ã—Å–ª–∞ —Ä–∞–∑–¥–µ–ª—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤, –ø–æ—ç—Ç–æ–º—É —Å–ª–æ–∂–∏–ª –∏ —Ç–∏–ø, –∏ –æ–±—ä–µ–∫—Ç –≤ –æ–¥–∏–Ω:

```ts
// src/settings/index.ts

import { container } from "../composition";

export type AppSettings = {
  canvasSize: Size;
};

export const settings: AppSettings = {
  canvasSize: {
    width: 800,
    height: 600,
  },
};

container.registerSingleton<AppSettings>(() => settings);
```

–ù–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–µ –º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç `settings`, –∫–∞–∫ _—á—Ç–æ-—Ç–æ —Ä–µ–∞–ª–∏–∑—É—é—â–µ–µ `AppSettings`_. –° —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –ª—é–±—ã–µ –º–æ–¥—É–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç `AppSettings` –≤ —Å–≤–æ—ë–º –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ, –ø–æ–ª—É—á–∞—Ç –æ–±—ä–µ–∫—Ç `settings`.

–í –ø—Ä–æ—à–ª–æ–º –ø–æ—Å—Ç–µ –º—ã –æ–±—Å—É–∂–¥–∞–ª–∏, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Äî –æ–Ω [–∑–∞–º–µ–Ω—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã](https://github.com/wessberg/di-compiler#faq). –û–±—ã—á–Ω–æ —ç—Ç–æ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –∫–ª–∞—Å—Å–æ–≤, –Ω–æ –≤ —Å–ª—É—á–∞–µ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ ‚Äî –ø—Ä–æ—Å—Ç–æ –æ–±—ä–µ–∫—Ç. –¢–∞–∫ —Ç–æ–∂–µ –º–æ–∂–Ω–æ üôÇ

### –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –º–æ–¥—É–ª—å

–î–æ–±–∞–≤–∏–º –≥–µ–æ–º–µ—Ç—Ä–∏—é –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:

```ts
// src/geometry/location/composition.ts

import { container } from "../../composition";
import { StartPointSelector } from "./implementation";
import { StartSelector } from "./types";

container.registerSingleton<StartSelector, StartPointSelector>();
```

–ì–æ—Ç–æ–≤–æ, –¥–æ–º–µ–Ω–Ω—ã–π —Å–ª–æ–π –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞–ø–∏—Å–∞–Ω!

## –†–∞–±–æ—Ç–∞–µ–º —Å –≥—Ä–∞—Ñ–∏–∫–æ–π

–ö–æ–≥–¥–∞ –º—ã —Ä–∞–±–æ—Ç–∞–µ–º —Å –≥—Ä–∞–º–æ—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π, –º—ã –Ω–µ –æ–±—è–∑–∞–Ω—ã –ø–∏—Å–∞—Ç—å –∫–æ–¥ –≤ –∫–∞–∫–æ–º-–ª–∏–±–æ –ø–æ—Ä—è–¥–∫–µ.

–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–≥—É—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ —Ä–∞–∑–Ω—ã–º–∏ —Å–ª–æ—è–º–∏: —á–∞—Å—Ç—å –∫–æ–º–∞–Ω–¥—ã –Ω–∞–¥ –¥–æ–º–µ–Ω–æ–º, –¥—Ä—É–≥–∞—è –Ω–∞–¥ –ø—Ä–∏–∫–ª–∞–¥–Ω—ã–º —É—Ä–æ–≤–Ω–µ–º, —Ç—Ä–µ—Ç—å—è ‚Äî –Ω–∞–¥ –ø–æ—Ä—Ç–∞–º–∏ –∏ –∞–¥–∞–ø—Ç–µ—Ä–∞–º–∏. –ì–ª–∞–≤–Ω–æ–µ ‚Äî —á—Ç–æ–±—ã –∫–æ–º–∞–Ω–¥—ã –¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å –æ–± API, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç —Å–≤—è–∑—ã–≤–∞—Ç—å –º–æ–¥—É–ª–∏.

–ß—Ç–æ–±—ã –¥–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ, –ø–µ—Ä–µ–ø—Ä—ã–≥–Ω–µ–º —á–µ—Ä–µ–∑ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π —Å–ª–æ–π –∏ –Ω–∞–ø–∏—à–µ–º –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `canvas`. –°–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ–º –≤—Ö–æ–¥—ã –∏ –≤—ã—Ö–æ–¥—ã:

![–î–∏–∞–≥—Ä–∞–º–º–∞ –ø—É–±–ª–∏—á–Ω–æ–≥–æ API –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–æ–¥—É–ª—è](/img/blog/treees-drawer-interface.png)

–ú–æ–¥—É–ª—å –±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –Ω–∞—Ä—É–∂—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Drawer`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è. –ê –∑–∞–≤–∏—Å–µ—Ç—å –º–æ–¥—É–ª—å –±—É–¥–µ—Ç –æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `DrawingContextProvider`. –ü–æ–º–Ω–∏–º, —á—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–∞–ø—Ç–µ—Ä–∞ –¥–æ–ª–∂–µ–Ω —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—Ç—å –Ω—É–∂–¥–∞–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: –º—ã –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤–Ω–µ—à–Ω–∏–π –º–∏—Ä –ø–æ–¥ –Ω–∞—à–∏ —Ö–æ—Ç–µ–ª–∫–∏, –∞ –Ω–µ –Ω–∞–æ–±–æ—Ä–æ—Ç.

–ó–∞–º–µ—Ç–∏–º, —á—Ç–æ –º—ã —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –ø–∏—à–µ–º –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –Ω–µ `CanvasDrawer`, –∞ `Drawer`. –ù–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–º, —á—Ç–æ–±—ã –µ–≥–æ –º–æ–≥–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –º–æ–¥—É–ª–∏: `CanvasDrawer` –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –Ω–∞ `canvas`, `SvgDrawer` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `svg` –∏ —Ç.–¥.

–¢–∞–∫ –º—ã –ø—Ä—è—á–µ–º –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ –º–∏—Ä–∞. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –≤ —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ –º—ã –∑–∞—Ö–æ—Ç–∏–º –∑–∞–º–µ–Ω–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é, –ø–æ—Ç–æ–º—É —á—Ç–æ [–¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –º–∏—Ä–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–µ–Ω—è–µ—Ç—Å—è](https://ota-solid.now.sh/lsp) ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —Ç–µ–º –∂–µ.

`DrawingContextProvider` –±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –¥–æ—Å—Ç—É–ø –∫ —ç–ª–µ–º–µ–Ω—Ç—É `canvas` –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ. –ü–æ—á–µ–º—É –Ω–µ –¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è –¥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø—Ä—è–º–æ –≤ —ç—Ç–æ–º –º–æ–¥—É–ª–µ? –ú—ã —Ö–æ—Ç–∏–º —Å–æ–±–ª—é—Å—Ç–∏ [–ø—Ä–∏–Ω—Ü–∏–ø –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏](https://ota-solid.now.sh/srp), –∞ –∑–Ω–∞—á–∏—Ç –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –¥–æ–ª–∂–µ–Ω –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–µ–π. ¬´–î–æ—Å—Ç—É–ø –∫ —ç–ª–µ–º–µ–Ω—Ç—É¬ª –∏ ¬´–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è¬ª ‚Äî —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ –∑–∞–¥–∞—á–∏, –ø–æ—ç—Ç–æ–º—É –Ω–∞–º –Ω—É–∂–Ω—ã —Ä–∞–∑–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏.

### –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Drawer`

–í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –æ–ø–∏—à–µ–º –º–µ—Ç–æ–¥ `drawLine`, –æ–Ω –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ—Ç—Ä–µ–∑–æ–∫ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ¬´–∫–∏—Å—Ç–∏¬ª: —à–∏—Ä–∏–Ω—É –∏ —Ü–≤–µ—Ç.

```ts
// src/graphics/drawer/types.ts

export type BrushSettings = {
  color?: Color;
  width?: PixelsAmount;
};

export interface Drawer {
  drawLine(line: Line, settings?: BrushSettings): void;
}
```

–î–æ–±–∞–≤–∏–º —Ç–∞–∫–∂–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤:

```ts
// typings/graphics.d.ts

type HexadecimalColor = string;
type Color = HexadecimalColor;
```

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∏—Å–æ–≤–∞–ª–∫–∏

–û–ø—Ä–µ–¥–µ–ª–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∏ –ø—É–±–ª–∏—á–Ω—ã–π –º–µ—Ç–æ–¥ `drawLine`:

```ts
// src/graphics/drawer/implementation.ts

import { DrawingContext, DrawingContextProvider } from "../context/types";
import { Drawer, BrushSettings } from "./types";

export class CanvasDrawer implements Drawer {
  private context: DrawingContext = null;

  constructor(private contextProvider: DrawingContextProvider) {
    this.context = this.contextProvider.getInstance();
    if (!this.context) throw new Error("Failed to access the drawing context.");
  }

  public drawLine({ start, end }: Line, { color, width }: BrushSettings = {}): void {
    // –ö–æ–¥ —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è...
  }
}
```

–í –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –º—ã –ø–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç —Ç–∏–ø–∞ `DrawingContextProvider`. –û–Ω –±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –Ω–∞–º –¥–æ—Å—Ç—É–ø –∫ —ç–ª–µ–º–µ–Ω—Ç—É, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –º–æ–∂–Ω–æ —Ä–∏—Å–æ–≤–∞—Ç—å. –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ –Ω–µ –Ω–∞—à–ª–æ—Å—å, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.

–ó–∞–¥–∞—á–∞ —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞ ‚Äî ¬´–ø–µ—Ä–µ–≤–µ—Å—Ç–∏¬ª –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç—Ä–µ–∑–æ–∫ –≤ –≤—ã–∑–æ–≤—ã –ø—É–±–ª–∏—á–Ω–æ–≥–æ API –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–µ, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç—Ä–∏—Å—É–µ—Ç —ç—Ç–æ—Ç –æ—Ç—Ä–µ–∑–æ–∫. –≠—Ç–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ DOM-—É–∑–µ–ª, –∞ –≤ –ø—Ä–∏–Ω—Ü–∏–ø–µ —á—Ç–æ —É–≥–æ–¥–Ω–æ, —á—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `DrawingContext`. –ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É –º—ã –Ω–µ –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ DOM –Ω–∞–ø—Ä—è–º—É—é –∏–∑ —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞.

–°–∞–º `DrawingContext`, –∫ —Å–ª–æ–≤—É, –≤ –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ ‚Äî —ç—Ç–æ –≤—Å–µ–≥–æ –ª–∏—à—å –æ–±—ë—Ä—Ç–∫–∞:

```ts
export type DrawingContext = Nullable<CanvasRenderingContext2D>;
```

–≠—Ç–æ –Ω–µ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å–µ–π—á–∞—Å –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –º—ã _–∑–∞–≤—è–∑—ã–≤–∞–µ–º—Å—è –Ω–∞ –º–µ—Ç–æ–¥—ã `CanvasRenderingContext2D`_:

```ts
// src/graphics/drawer/implementation.ts

export class CanvasDrawer implements Drawer {
  // ...

  public drawLine({ start, end }: Line, { color, width }: BrushSettings = {}): void {
    if (!this.context) return;

    this.context.strokeStyle = color ?? DEFAULT_COLOR;
    this.context.lineWidth = width ?? DEFAULT_WIDTH;

    // –ú–µ—Ç–æ–¥—ã beginPath, moveTo, lineTo –∏ stroke ‚Äî
    // —ç—Ç–æ –ø—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `CanvasRenderingContext2D`:
    this.context.beginPath();
    this.context.moveTo(start.x, start.y);
    this.context.lineTo(end.x, end.y);
    this.context.stroke();
  }
}
```

–í –∏–¥–µ–∞–ª–µ –Ω–∞–º —Å—Ç–æ–∏—Ç –Ω–∞–ø–∏—Å–∞—Ç—å [—Ñ–∞—Å–∞–¥](https://github.com/kamranahmedse/design-patterns-for-humans#-facade), –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä—è—Ç–∞—Ç—å –∑–∞ —Å–æ–±–æ–π –≤—ã–∑–æ–≤ —ç—Ç–∏—Ö –º–µ—Ç–æ–¥–æ–≤ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –Ω–∞—Ä—É–∂—É –Ω–µ—á—Ç–æ —Ç–∏–ø–∞:

```ts
this.context.line(start, end);
```

–ù–æ –ø–æ—Å—Ç –Ω–µ —Ä–µ–∑–∏–Ω–æ–≤—ã–π, –ø–æ—ç—Ç–æ–º—É —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —Ñ–∞—Å–∞–¥ –Ω–µ –±—É–¥–µ–º, –ø—Ä–æ—Å—Ç–æ –±—É–¥–µ–º –∏–º–µ—Ç—å —ç—Ç–æ –≤ –≤–∏–¥—É.

### –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Ä–∏—Å–æ–≤–∞–ª–∫—É

–î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:

```ts
// src/graphics/drawer/composition.ts

import { container } from "../../composition";
import { CanvasDrawer } from "./implementation";
import { Drawer } from "./types";

container.registerSingleton<Drawer, CanvasDrawer>();
```

## –ü—Ä–æ–µ–∫—Ç–∏—Ä—É–µ–º `DrawingContextProvider`

–û–±—ä–µ–∫—Ç—É `Drawer` –Ω—É–∂–µ–Ω –±—É–¥–µ—Ç —ç–ª–µ–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–º –æ–Ω –±—É–¥–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å. –ó–∞–¥–∞—á–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ ‚Äî –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–∞–∫–æ–π —ç–ª–µ–º–µ–Ω—Ç.

`DrawingContextProvider` –±—É–¥–µ—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –¥–≤—É—Ö –≤–µ—â–µ–π:

- –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ `ElementSource`;
- –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –ø–∏–∫—Å–µ–ª–µ–π –Ω–∞ —ç–∫—Ä–∞–Ω–µ `PixelRatioSource`.

–ü–µ—Ä–≤—ã–π –Ω–∞–º –Ω—É–∂–µ–Ω, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ —ç–ª–µ–º–µ–Ω—Ç—É `canvas`, –∞ –≤—Ç–æ—Ä–æ–π ‚Äî —á—Ç–æ–±—ã –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –µ–≥–æ —Ä–∞–∑–º–µ—Ä—ã –Ω–∞ —Ä–µ—Ç–∏–Ω–∞-–¥–∏—Å–ø–ª–µ—è—Ö. –ë–µ–∑ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –º—ã–ª—å–Ω—ã–º.

![–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –ø—É–±–ª–∏—á–Ω–æ–µ API –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞](/img/blog/treees-context-provider.png)

–û–ø–∏—à–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. (–ü–æ–º–Ω–∏–º, —á—Ç–æ –ø–æ-—Ö–æ—Ä–æ—à–µ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ñ–∞—Å–∞–¥–æ–º –Ω–∞–¥ `CanvasRenderingContext2D`.)

```ts
// src/graphics/context/types.ts

export type DrawingContext = Nullable<CanvasRenderingContext2D>;

export interface DrawingContextProvider {
  getInstance(): DrawingContext;
}
```

### –ü–∏—à–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é

–í –∫–ª–∞—Å—Å–µ –∫—Ä–æ–º–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –ø–æ–ª—è—Ö –±—É–¥–µ–º –¥–µ—Ä–∂–∞—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç `canvas` –∏ –µ–≥–æ 2D-–∫–æ–Ω—Ç–µ–∫—Å—Ç:

```ts
import { AppSettings } from "../../settings";
import { ElementSource, PixelRatioSource } from "../../dom/types";
import { DrawingContext, DrawingContextProvider } from "./types";

export class CanvasContextProvider implements DrawingContextProvider {
  private element: Nullable<HTMLCanvasElement> = null;
  private context: Nullable<DrawingContext> = null;

  constructor(
    private elementSource: ElementSource,
    private pixelRatioSource: PixelRatioSource,
    private settings: AppSettings,
  ) {
    const element = this.elementSource.getElementById("canvas");
    if (!element) throw new Error("Failed to find a canvas element.");

    this.element = element as HTMLCanvasElement;
    this.context = this.element.getContext("2d");
    this.normalizeScale();
  }

  public getInstance(): DrawingContext {
    return this.context;
  }

  // ...
}
```

–í –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ `ElementSource` –∏ –ø–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç. –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –µ—Å—Ç—å, –ø–æ–ª—É—á–∞–µ–º –µ–≥–æ 2D-–∫–æ–Ω—Ç–µ–∫—Å—Ç. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –º–∞—Å—à—Ç–∞–±, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ ¬´–º—ã–ª–∞¬ª.

–ò–∑ –º–µ—Ç–æ–¥–∞ `getInstance` –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 2D-–∫–æ–Ω—Ç–µ–∫—Å—Ç. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –º–æ–∂–Ω–æ –±—ã–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–µ—Ç—Ç–µ—Ä, —á—Ç–æ–±—ã –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω–æ–µ –ø–æ–ª–µ `context` –≤ –ø—É–±–ª–∏—á–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ, –Ω–æ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ.

–ó–∞–º–µ—Ç—å—Ç–µ, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –Ω–∞—Ä—É–∂—É –º—ã –Ω–∏–∫–∞–∫ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º. –û–Ω –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω –≤ —ç—Ç–æ–º –∫–ª–∞—Å—Å–µ, –∏ –Ω–∏–∫—Ç–æ –±–æ–ª—å—à–µ –Ω–µ –∑–Ω–∞–µ—Ç, –∫–∞–∫ –∏ –æ—Ç–∫—É–¥–∞ –∏–º–µ–Ω–Ω–æ –º—ã –ø–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç. –ü–æ—ç—Ç–æ–º—É –µ—Å–ª–∏ –º—ã –ø–µ—Ä–µ–µ–¥–µ–º —Å `canvas` –Ω–∞ —á—Ç–æ-—Ç–æ –µ—â—ë, –∏–∑–º–µ–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ —ç—Ç–æ—Ç –∫–ª–∞—Å—Å. (–ü—Ä–∏ —É—Å–ª–æ–≤–∏–∏, —á—Ç–æ `DrawingContext` ‚Äî —ç—Ç–æ —Ñ–∞—Å–∞–¥ üòÉ)

–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –º–∞—Å—à—Ç–∞–±–∞ –º—ã –ø—Ä–æ–≤–æ–¥–∏–º –∑–¥–µ—Å—å –ø–æ —Ç–æ–π –∂–µ –ø—Ä–∏—á–∏–Ω–µ: –Ω–∏–∫–æ–≥–æ –±–æ–ª—å—à–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –≤–æ–ª–Ω–æ–≤–∞—Ç—å, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ –≥–æ—Ç–æ–≤–∏—Ç—å –ø–æ–ª–æ—Ç–Ω–æ. [–ö–æ–¥ –º–µ—Ç–æ–¥–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –ø–æ–¥—Å–º–æ—Ç—Ä–µ—Ç—å <nobr>–Ω–∞ –ì–∏—Ç—Ö–∞–±–µ ;‚Äì)</nobr>](https://github.com/bespoyasov/treees/blob/a09fce0cbd69c8f078d257c3c5b01eb6aedeb6e4/src/graphics/context/implementation.ts#L26)

### –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä

–¢—É—Ç –≤—Å—ë, –∫–∞–∫ –≤–µ–∑–¥–µ:

```ts
// src/graphics/context/composition.ts

import { container } from "../../composition";
import { CanvasContextProvider } from "./implementation";
import { DrawingContextProvider } from "./types";

container.registerSingleton<DrawingContextProvider, CanvasContextProvider>();
```

### –ß—Ç–æ –µ—â—ë

–ù–∞–º —Ç–∞–∫–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å `ElementSource` –∏ `PixelRatioSource`. –ó–∞ –ø–µ—Ä–≤—ã–π –±—É–¥–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –∞–¥–∞–ø—Ç–µ—Ä –Ω–∞–¥ `document`, –∑–∞ –≤—Ç–æ—Ä–æ–π ‚Äî `window`.

```ts
// src/dom/types.ts

export interface ElementSource {
  getElement(id: string): Nullable<HTMLElement>;
}

export interface PixelRatioSource {
  devicePixelRatio?: number;
}
```

–†–µ–∞–ª–∏–∑–∞—Ü–∏—é —ç—Ç–∏—Ö –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ –∏ –∏—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –º–æ–∂–Ω–æ [–ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –ì–∏—Ç—Ö–∞–±–µ](https://github.com/bespoyasov/treees/tree/main/src/dom). –û–Ω–∞ –∫–æ—Ä–æ—Ç–∫–∞—è.

## –°–æ–±–∏—Ä–∞–µ–º –≤—Å—ë –≤–º–µ—Å—Ç–µ

–°–µ–π—á–∞—Å –Ω–∞—à–∏ –º–æ–¥—É–ª–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤–æ—Ç –≤ —Ç–∞–∫–æ–º —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–∏ –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º:

![–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è ‚Äî —ç—Ç–æ –≤—Ö–æ–¥–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥—Ä—É–≥–∏—Ö](/img/blog/treees-graphics-diagram.png)

–ù–∏ –æ–¥–∏–Ω –º–æ–¥—É–ª—å [–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –Ω–∞–ø—Ä—è–º—É—é –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](https://ota-solid.now.sh/dip) –¥—Ä—É–≥–æ–≥–æ. –≠—Ç–æ –¥–∞—ë—Ç –Ω–∞–º —Å–≤–æ–±–æ–¥—É –≤ –≤—ã–±–æ—Ä–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏, —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ –∏ –∑–∞–º–µ–Ω–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ –¥—Ä—É–≥—É—é.

### –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É

–ß—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫ —Ä–∏—Å–æ–≤–∞–ª–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ª—É—á–∏–º –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –æ–±—ä–µ–∫—Ç, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π `Drawer`, –∏ –≤—ã–∑–æ–≤–µ–º –º–µ—Ç–æ–¥ `drawLine`, –ø–µ—Ä–µ–¥–∞–≤ –¥–≤–µ —Ç–æ—á–∫–∏:

```ts
// src/index.ts

import { container } from "./composition";
import { Drawer } from "./graphics/types";

const drawer = container.get<Drawer>();

drawer.drawLine({
  start: { x: 0, y: 0 },
  end: { x: 100, y: 100 },
});
```

–≠—Ç–æ—Ç –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å –¥–∏–∞–≥–æ–Ω–∞–ª—å–Ω—ã–π –æ—Ç—Ä–µ–∑–æ–∫ –≤–Ω—É—Ç—Ä–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ `canvas`:

![–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ](/img/blog/treees-canvas-result.png)

–°—Ä–∞–±–æ—Ç–∞–ª–æ! üéâ<br />
–û—Å—Ç–∞–ª–æ—Å—å —Ç–µ–ø–µ—Ä—å —Å–≤—è–∑–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫—É –∏ –¥–æ–º–µ–Ω–Ω—ã–π —Å–ª–æ–π ü§ì

## –í —Å–ª–µ–¥—É—é—â–µ–π —Å–µ—Ä–∏–∏

–í [—Ç—Ä–µ—Ç—å–µ–π —á–∞—Å—Ç–∏](/blog/generating-trees-on-canvas-using-typescript-and-oop-3) –Ω–∞–ø–∏—à–µ–º ¬´–ø–µ—Ä–µ–≤–æ–¥—á–∏–∫¬ª —Å —è–∑—ã–∫–∞ L-—Å–∏—Å—Ç–µ–º –Ω–∞ —è–∑—ã–∫ –∫–æ–º–∞–Ω–¥ –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –Ω–∞ `canvas`. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–µ—Ä–µ–≤–æ –ü–∏—Ñ–∞–≥–æ—Ä–∞, –¥–æ–±–∞–≤–∏–º –µ–º—É —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏ –∏ —Ü–≤–µ—Ç–∞, —á—Ç–æ–±—ã –æ–Ω–æ —Å—Ç–∞–ª–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –Ω–∞—Å—Ç–æ—è—â–µ–µ –¥–µ—Ä–µ–≤–æ.

## –°—Å—ã–ª–∫–∏ –∏–∑ –ø–æ—Å—Ç–∞

–î—Ä—É–≥–∏–µ –ø–æ—Å—Ç—ã –∏–∑ —Å–µ—Ä–∏–∏, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å –∏—Å—Ö–æ–¥–Ω–∏–∫–∞–º–∏ –∏ –ø—Ä–æ–µ–∫—Ç –∂–∏–≤—å—ë–º:

- [–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ](/showcase/treees/)
- [–ü—Ä–æ–µ–∫—Ç –Ω–∞ –ì–∏—Ç—Ö–∞–±–µ](https://github.com/bespoyasov/treees)
- [–ü–µ—Ä–≤–∞—è —á–∞—Å—Ç—å](/blog/generating-trees-on-canvas-using-typescript-and-oop)
- [–¢—Ä–µ—Ç—å—è —á–∞—Å—Ç—å](/blog/generating-trees-on-canvas-using-typescript-and-oop-3)

–ü—Ä–∏–Ω—Ü–∏–ø—ã SOLID:

- [–ü—Ä–∏–Ω—Ü–∏–ø –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏, SRP](https://ota-solid.now.sh/srp)
- [–ü—Ä–∏–Ω—Ü–∏–ø –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç–∏ –∏ –∑–∞–∫—Ä—ã—Ç–æ—Å—Ç–∏, OCP](https://ota-solid.now.sh/ocp)
- [–ü—Ä–∏–Ω—Ü–∏–ø –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –õ–∏—Å–∫–æ–≤, LSP](https://ota-solid.now.sh/lsp)
- [–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, ISP](https://ota-solid.now.sh/isp)
- [–ü—Ä–∏–Ω—Ü–∏–ø –∏–Ω–≤–µ—Ä—Å–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, DIP](https://ota-solid.now.sh/dip)

TypeScript, —Ç—É–ª–∏–Ω–≥ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

- [–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä](https://github.com/wessberg/di-compiler#faq)
- [–§–∞—Å–∞–¥, —à–∞–±–ª–æ–Ω –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](https://github.com/kamranahmedse/design-patterns-for-humans#-facade)
